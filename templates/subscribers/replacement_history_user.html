{% extends 'subscriber_base.html' %}
{% load static %}

{% block title %}Replacement History{% endblock %}

{% block content %}

<div class="mb-4">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
        <div>
            <h2 class="text-xl font-bold text-gray-800">Lead Replacement History</h2>
            <p class="text-gray-600 text-sm mt-1">Track your lead replacements and new assignments</p>
        </div>
        <a href="{% url 'subscribers:my_leads' %}" 
           class="inline-flex items-center px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-colors duration-200 mt-2 sm:mt-0">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Leads
        </a>
    </div>

    <!-- Compact Info -->
    <div class="bg-blue-50 rounded-lg p-3 border border-blue-200 mb-4">
        <div class="flex items-start">
            <svg class="w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="text-sm text-gray-700">View your lead replacement history. Search for new leads in "Leads" page.</p>
        </div>
    </div>
</div>

{% if history_data %}
<!-- Desktop Table View -->
<div class="hidden lg:block">
    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Old Lead</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">New Lead</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Reason</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">By</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for history in history_data %}
                    <tr class="hover:bg-gray-50 transition-colors duration-150">
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="font-medium text-gray-900">{{ history.replaced_at|date:"M d, Y" }}</div>
                            <div class="text-gray-500 text-xs">{{ history.replaced_at|date:"H:i" }}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="space-y-1">
                                <div class="flex items-center space-x-2">
                                    <div class="w-6 h-6 bg-red-100 rounded flex items-center justify-center flex-shrink-0">
                                        <svg class="w-3 h-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                    <div class="min-w-0">
                                        <div class="font-medium text-gray-900 truncate">{{ history.old_lead_name }}</div>
                                        <div class="text-gray-500 text-xs truncate">{{ history.old_lead_phone }}</div>
                                        {% if history.old_lead_email %}
                                        <div class="text-gray-500 text-xs truncate">{{ history.old_lead_email }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="space-y-1">
                                <div class="flex items-center space-x-2">
                                    <div class="w-6 h-6 bg-green-100 rounded flex items-center justify-center flex-shrink-0">
                                        <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div class="min-w-0">
                                        <div class="font-medium text-green-700 truncate">{{ history.new_lead_name }}</div>
                                        <div class="text-gray-500 text-xs truncate">{{ history.new_lead_phone }}</div>
                                        {% if history.new_lead_email %}
                                        <div class="text-gray-500 text-xs truncate">{{ history.new_lead_email }}</div>
                                        {% endif %}
                                        <a href="{% url 'subscribers:my_leads' %}" 
                                           class="inline-flex items-center mt-1 text-blue-600 hover:text-blue-700 text-xs">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                            Search
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                {{ history.reason }}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="text-gray-900 text-sm">Admin</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Mobile Card View -->
<div class="lg:hidden space-y-3">
    {% for history in history_data %}
    <div class="bg-white rounded-lg border border-gray-200 p-4">
        <!-- Header -->
        <div class="flex justify-between items-start mb-3">
            <div class="flex items-center space-x-2">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                    {{ history.reason }}
                </span>
                <span class="text-xs text-gray-500">{{ history.replaced_at|date:"M d, H:i" }}</span>
            </div>
            <div class="text-xs text-gray-500">By: {{ history.replaced_by }}</div>
        </div>

        <!-- Replacement Flow -->
        <div class="space-y-2">
            <!-- Old Lead -->
            <div class="p-2 bg-red-50 rounded border border-red-100">
                <div class="flex items-center space-x-2 mb-1">
                    <div class="w-6 h-6 bg-red-100 rounded flex items-center justify-center flex-shrink-0">
                        <svg class="w-3 h-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="font-medium text-gray-900 text-sm">Old Lead</div>
                </div>
                <div class="ml-8 space-y-1">
                    <div class="font-medium text-gray-900 text-sm truncate">{{ history.old_lead_name }}</div>
                    <div class="text-gray-600 text-xs truncate">{{ history.old_lead_phone }}</div>
                    {% if history.old_lead_email %}
                    <div class="text-gray-600 text-xs truncate">{{ history.old_lead_email }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Arrow -->
            <div class="flex justify-center">
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>

            <!-- New Lead -->
            <div class="p-2 bg-green-50 rounded border border-green-100">
                <div class="flex items-center space-x-2 mb-1">
                    <div class="w-6 h-6 bg-green-100 rounded flex items-center justify-center flex-shrink-0">
                        <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <div class="font-medium text-gray-900 text-sm">New Lead</div>
                </div>
                <div class="ml-8 space-y-1">
                    <div class="font-medium text-green-700 text-sm truncate">{{ history.new_lead_name }}</div>
                    <div class="text-gray-600 text-xs truncate">{{ history.new_lead_phone }}</div>
                    {% if history.new_lead_email %}
                    <div class="text-gray-600 text-xs truncate">{{ history.new_lead_email }}</div>
                    {% endif %}
                    <a href="{% url 'subscribers:my_leads' %}" 
                       class="inline-flex items-center mt-1 text-blue-600 hover:text-blue-700 text-xs">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        Search in My Leads
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<!-- Compact Empty State -->
<div class="bg-white rounded-lg border border-gray-200 p-6 text-center">
    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
    </div>
    <h3 class="text-lg font-semibold text-gray-800 mb-1">No Replacement History</h3>
    <p class="text-gray-600 text-sm mb-4">You don't have any lead replacements yet.</p>
    <a href="{% url 'subscribers:my_leads' %}" 
       class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors duration-200">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to My Leads
    </a>
</div>
{% endif %}

<style>
/* Compact table styling */
.text-sm table {
    font-size: 0.875rem;
    line-height: 1.25rem;
}

/* Reduce padding in table cells */
.px-4.py-3 {
    padding-left: 1rem;
    padding-right: 1rem;
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
}

/* Compact card styling */
.space-y-3 > * + * {
    margin-top: 0.75rem;
}

/* Smaller icons and elements */
.w-6.h-6 {
    width: 1.5rem;
    height: 1.5rem;
}

.w-3.h-3 {
    width: 0.75rem;
    height: 0.75rem;
}

/* Tight info box */
.p-3 {
    padding: 0.75rem;
}

/* Better email display */
.text-xs.truncate {
    max-width: 200px;
}

@media (max-width: 768px) {
    .text-xs.truncate {
        max-width: 150px;
    }
}
</style>

{% endblock %}


{% comment %} {% extends 'subscriber_base.html' %}
{% load static %}

{% block title %}Replacement History{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-history text-info"></i> 
                    Lead Replacement History
                </h3>
                <div class="card-tools">
                    <a href="{% url 'subscribers:my_leads' %}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i> Back to My Leads
                    </a>
                </div>
            </div>
            <div class="card-body">
                <!-- Summary -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle"></i> About Replacement History</h5>
                            <p class="mb-0">This shows all your lead replacements. You can search for new leads in "My Leads" page using their details.</p>
                        </div>
                    </div>
                </div>

                {% if history_data %}
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="thead-dark">
                            <tr>
                                <th>Replacement Date</th>
                                <th>Old Lead</th>
                                <th>Replaced With</th>
                                <th>New Lead Details</th>
                                <th>Reason</th>
                                <th>Replaced By</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for history in history_data %}
                            <tr>
                                <td>{{ history.replaced_at|date:"M d, Y H:i" }}</td>
                                <td>
                                    <div class="lead-info">
                                        <strong>{{ history.old_lead_name }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {{ history.old_lead_phone }} | 
                                            {{ history.old_lead_type }}
                                        </small>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <i class="fas fa-arrow-right text-success"></i>
                                </td>
                                <td>
                                    <div class="lead-info">
                                        <strong class="text-success">{{ history.new_lead_name }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            üìû {{ history.new_lead_phone }}<br>
                                            üìß {{ history.new_lead_email }}<br>
                                            üè∑Ô∏è {{ history.new_lead_type }}
                                        </small>
                                        <br>
                                        <a href="{% url 'subscribers:my_leads' %}" class="btn btn-sm btn-outline-primary mt-1">
                                            <i class="fas fa-search"></i> Search in My Leads
                                        </a>
                                    </div>
                                </td>
                                <td>{{ history.reason }}</td>
                                <td>{{ history.replaced_by }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle fa-2x mb-3"></i>
                    <h4>No Replacement History</h4>
                    <p>You don't have any lead replacements yet.</p>
                    <a href="{% url 'subscribers:my_leads' %}" class="btn btn-primary">
                        <i class="fas fa-arrow-left"></i> Back to My Leads
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.lead-info {
    line-height: 1.4;
}
</style>
{% endblock %} {% endcomment %}